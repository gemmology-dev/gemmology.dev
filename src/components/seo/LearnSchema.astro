---
/**
 * LearnSchema - JSON-LD structured data for learn pages
 * Improves SEO and enables rich results in search engines
 */

interface Props {
  title: string;
  description: string;
  category: string;
  subcategory?: string;
  difficulty?: string;
  slug: string;
}

const { title, description, category, subcategory, difficulty, slug } = Astro.props;
const url = `https://gemmology.dev/learn/${slug}`;

// Helper to format category names
function formatName(name: string): string {
  return name
    .split('-')
    .map(word => word.charAt(0).toUpperCase() + word.slice(1))
    .join(' ');
}

// Article schema for educational content
const articleSchema = {
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": title,
  "description": description,
  "author": {
    "@type": "Organization",
    "name": "gemmology.dev",
    "url": "https://gemmology.dev"
  },
  "publisher": {
    "@type": "Organization",
    "name": "gemmology.dev",
    "url": "https://gemmology.dev",
    "logo": {
      "@type": "ImageObject",
      "url": "https://gemmology.dev/favicon.svg"
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": url
  },
  "educationalLevel": difficulty || "intermediate",
  "learningResourceType": "Article",
  "about": {
    "@type": "Thing",
    "name": formatName(category)
  }
};

// Build breadcrumb from category/subcategory
const breadcrumbItems = [
  { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://gemmology.dev" },
  { "@type": "ListItem", "position": 2, "name": "Learn", "item": "https://gemmology.dev/learn" },
  { "@type": "ListItem", "position": 3, "name": formatName(category), "item": `https://gemmology.dev/learn#${category}` },
];

if (subcategory) {
  breadcrumbItems.push({
    "@type": "ListItem",
    "position": 4,
    "name": formatName(subcategory),
    "item": url
  });
  breadcrumbItems.push({
    "@type": "ListItem",
    "position": 5,
    "name": title,
    "item": url
  });
} else {
  breadcrumbItems.push({
    "@type": "ListItem",
    "position": 4,
    "name": title,
    "item": url
  });
}

const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": breadcrumbItems
};
---

<script type="application/ld+json" set:html={JSON.stringify(articleSchema)} />
<script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />
