---
/**
 * CrystalStructureCard - Shows CDL notation and crystal forms
 */
import type { Mineral } from '../../lib/db';

interface Props {
  mineral: Mineral;
}

const { mineral } = Astro.props;

// Parse CDL to extract forms (simplified parsing)
function parseForms(cdl: string): string[] {
  const formMatches = cdl.match(/\{[^}]+\}/g);
  return formMatches || [];
}

const forms = mineral.cdl ? parseForms(mineral.cdl) : [];
---

<div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
  <div class="px-6 py-4 border-b border-slate-100">
    <h2 class="text-lg font-semibold text-slate-900">Crystal Structure</h2>
  </div>

  <div class="p-6 space-y-4">
    <!-- CDL Notation -->
    {mineral.cdl && (
      <div>
        <label class="block text-sm font-medium text-slate-700 mb-2">
          CDL Notation
        </label>
        <code class="block w-full px-4 py-3 bg-slate-900 text-sky-400 rounded-lg font-mono text-sm overflow-x-auto">
          {mineral.cdl}
        </code>
      </div>
    )}

    <!-- Crystal System & Point Group -->
    <div class="grid grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium text-slate-700 mb-1">
          Crystal System
        </label>
        <span class="text-slate-900">{mineral.system}</span>
      </div>

      {mineral.cdl && (
        <div>
          <label class="block text-sm font-medium text-slate-700 mb-1">
            Point Group
          </label>
          <span class="font-mono text-slate-900">
            {mineral.cdl.match(/\[([^\]]+)\]/)?.[1] || 'Unknown'}
          </span>
        </div>
      )}
    </div>

    <!-- Crystal Forms -->
    {forms.length > 0 && (
      <div>
        <label class="block text-sm font-medium text-slate-700 mb-2">
          Crystal Forms ({forms.length})
        </label>
        <div class="flex flex-wrap gap-2">
          {forms.map((form) => (
            <span class="inline-flex items-center px-3 py-1 rounded-full bg-slate-100 text-slate-700 font-mono text-sm">
              {form}
            </span>
          ))}
        </div>
      </div>
    )}
  </div>
</div>
