---
/**
 * CrystalSystemCard - A color-coded card for displaying crystal system information
 * Provides visual differentiation between the seven crystal systems
 */
import Badge from '../ui-astro/Badge.astro';
import { crystalSystemColors, defaultCrystalCDL, type CrystalSystem } from './icons';

interface Item {
  name: string;
  value?: string;
  description?: string;
  examples?: string[];
}

interface Props {
  system: CrystalSystem;
  title: string;
  content?: string;
  items?: Item[];
  cdl?: string;
}

const { system, title, content, items = [], cdl } = Astro.props;

const colors = crystalSystemColors[system];
const crystalCdl = cdl || defaultCrystalCDL[system];
const playgroundUrl = `/playground?cdl=${encodeURIComponent(crystalCdl)}`;

// System display names
const systemNames: Record<CrystalSystem, string> = {
  cubic: 'Cubic',
  hexagonal: 'Hexagonal',
  trigonal: 'Trigonal',
  tetragonal: 'Tetragonal',
  orthorhombic: 'Orthorhombic',
  monoclinic: 'Monoclinic',
  triclinic: 'Triclinic',
};

// Property icons as inline SVGs
const propertyIcons: Record<string, string> = {
  axes: '<path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m-8-8h16" />',
  angles: '<path stroke-linecap="round" stroke-linejoin="round" d="M12 3v6m0 0l3-3m-3 3L9 6m3 15a9 9 0 100-18" />',
  symmetry: '<path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />',
  pointGroups: '<path stroke-linecap="round" stroke-linejoin="round" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />',
  gems: '<path stroke-linecap="round" stroke-linejoin="round" d="M12 3L2 8l10 14L22 8l-10-5zM2 8l10 4 10-4" />',
};

function getIconPath(name: string): string {
  const lower = name.toLowerCase();
  if (lower.includes('axes')) return propertyIcons.axes;
  if (lower.includes('angle')) return propertyIcons.angles;
  if (lower.includes('symmetry')) return propertyIcons.symmetry;
  if (lower.includes('point')) return propertyIcons.pointGroups;
  if (lower.includes('gem') || lower.includes('example')) return propertyIcons.gems;
  return propertyIcons.axes; // default
}

// Separate items into property items and example gems
const propertyItems = items.filter(item => !item.examples || item.examples.length === 0);
const exampleItem = items.find(item => item.examples && item.examples.length > 0);
---

<div class={`rounded-xl border-2 ${colors.border} ${colors.bgLight} overflow-hidden mt-8 mb-4`}>
  <!-- Header with system color -->
  <div class={`${colors.bg} px-4 py-3 flex items-center justify-between`}>
    <div class="flex items-center gap-3">
      <div class="w-8 h-8 rounded-lg bg-white/20 flex items-center justify-center flex-shrink-0">
        <svg class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
        </svg>
      </div>
      <span class="text-lg font-semibold text-white leading-none">{title}</span>
    </div>
    <a
      href={playgroundUrl}
      class="text-white/80 hover:text-white transition-colors flex items-center gap-1.5 text-sm leading-none flex-shrink-0"
      title="View crystal in playground"
    >
      <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
        <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <span class="hidden sm:inline">View Crystal</span>
    </a>
  </div>

  <!-- Content area -->
  <div class="p-4">
    {content && (
      <p class={`text-sm ${colors.text} mb-4`}>{content}</p>
    )}

    <!-- Property list (vertical) -->
    {propertyItems.length > 0 && (
      <div class="space-y-2">
        {propertyItems.map(item => (
          <div class={`${colors.accent} rounded-lg px-4 py-2.5 flex items-center justify-between gap-4`}>
            <div class="flex items-center gap-3">
              <div class={`${colors.bg} w-7 h-7 rounded-md flex items-center justify-center flex-shrink-0`}>
                <svg class="w-3.5 h-3.5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <Fragment set:html={getIconPath(item.name)} />
                </svg>
              </div>
              <div class="text-xs font-medium text-slate-500 uppercase tracking-wide">{item.name}</div>
            </div>
            <div class="text-right">
              {item.value && (
                <div class="font-mono text-sm text-slate-900">{item.value}</div>
              )}
              {item.description && !item.value && (
                <div class="text-sm text-slate-600">{item.description}</div>
              )}
            </div>
          </div>
        ))}
      </div>
    )}

    <!-- Example gems section -->
    {exampleItem && exampleItem.examples && (
      <div class="mt-4 pt-4 border-t border-slate-200/50">
        <div class="flex items-center gap-2 mb-2">
          <svg class={`w-4 h-4 ${colors.text}`} fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <Fragment set:html={propertyIcons.gems} />
          </svg>
          <span class="text-xs font-medium text-slate-500 uppercase tracking-wide">Example Gems</span>
        </div>
        <div class="flex flex-wrap gap-1.5">
          {exampleItem.examples.map(gem => (
            <Badge variant={system} size="sm">{gem}</Badge>
          ))}
        </div>
      </div>
    )}
  </div>
</div>
